#!/usr/local/bin/bash
tee >(tail -n +10 | sort -r -k11,11 | head -n 5 | awk ' BEGIN {print "1 Top Five Processes of WCPU over 0.5\n2  \n3 PID   command      user        WCPU"} {if ($11 > 0.5) printf "%-2i%-6s%-13s%-12s%-8s\n",NR+3,$1,$12,$2,$11} ') > >(tail -n +10 | head -n 5 | awk ' BEGIN {print "9  \n10 Top Five Processes of RES\n11  \n12 PID   command      user        RES"} {printf "%-3i%-6s%-13s%-12s%-8s\n",NR+12,$1,$12,$2,$7} END {print "18  \n19 Bad Users: \n20  "}') | sort -k1,2 -g | cut -d' ' -f2- | tee >(sed  -e '1,3d' -e '9,12d' -e '18,20d' | awk ' {print $3} ' | sort | uniq -c | awk ' {if ($2 == "root") print "\033[0;32m" $2 "\033[0m "; else if ($1 == 1) print "\033[0;33m" $2 "\033[0m "; else if ($1 >= 2) print "\033[0;31m" $2 "\033[0m "}')
